# Ch.06 교착상태

## 1. 교착상태의 개요
    ### 1-1. 교착상태란
            : 2개 이상의 작업이 동시에 이루어지는 경우, 다른 작업이 끝나기만을 기다리면 작업을 더 이상 진행하지 못하는 상태를 말한다.

            - 시스템 자원 ex) 프린터와 스캐너
            - 잠금 ex) 임계구역 문제를 해결하기 위한 잠금
            - 응용 프로그램 ex) 데이터베이스
    
            <-> 아사현상 
                : 잘못된 정책으로 특정 프로세스의 작업이 지연되는 문제

    ### 1-2. 자원할당 그래프
            : 프로세스가 어떤 자원을 사용 중이고 어떤 자원을 기다리고 있는지를 방향성이 있는 그래프로 표현한 것
            
            - 다중자원: 여러 프로세스가 동시에 사용하는 자원

## 2. 교착 상태 필요조건
    : 교착상태는 여러 가지 조건에 의해 발생한다. 아래 네 조건을 동시에 만족해야만 교착 상태가 발생한다.

    - 상호배제
      : 한 프로세스가 사용하는 자원은 다른 프로세스와 공유할 수 없는 배타적인 자원이어야 한다.

    - 비선점
      : 한 프로세스가 사용 중인 자원은 중간에 다른 프로세스사 빼앗을 수 없는 비섬점 자원이어야 한다.

    - 점유와 대기
      : 프로세스가 어떤 자원을 할당받은 상태에서 다른 자원을 기다리는 상태여야 한다.

    - 원형 대기
      : 점유와 대기를 하는 프로세스 간의 관계가 원을 이루어야 한다.

## 3. 교착 상태 해결 방법
    ### 3-1. 교착 상태 해결과 예방
        : 교착상태는 아사현상보다 처리가 복잡한데, 이를 해결하는 방법으로 예방, 회피, 검출, 회복 방법이 있다.

        - 교착 상태 예방
          : 교착 상태를 유발하는 네가지 조건이 발생하지 않도록 무력화 하는 방식 -> 실효성이 적어 잘 사용되지 않는다.

            - 상호배제 예방 
              : 독저적으로 사용할 수 있는 자원을 없애버리는 방법 
                -> 자원을 보호하기 어렵다.
            
            - 비선점 예방
              : 모든 자원을 빼앗을 수 있도록 하는 방법 
                -> 아사현상을 일으키며 자원을 보호하기 어렵다.

            - 점유와 대기 예방
              : 프로세스가 자원을 점유한 상태에서 다른 자워을 기다리지 못하게 하는 방법   
                -> 프로세스가 자신이 사용하는 모든 자원을 자세히 알기 어렵다.
                -> 자원의 활용성이 떨어진다.
                -> 많은 자원을 사용하는 프로세스가 적은 자원을 사용하는 프로세스보다 불리하다.
                -> 결국 일괄 방식으로 동작한다.

            - 원형 대기 예방
              : 점유와 대기를 하는 프로세스들이 원형을 이루지 못하도록 막는 방법
                -> 프로세스 작업 진행에 유연성이 떨어진다.
                -> 자원에 번호를 어떻게 부여할지가 문제다.

        - 교착 상태 회피
          : 자원 할당량을 조절하여 교착 상태를 해결하는 방식 -> 실효성이 적어 잘 사용되지 않는다.
            즉 교착 상태가 발생하지 않는 범위 내에서만 자원을 할당하고, 교착 상태가 발생하는 범위에 있으면 프로세스를 대기 시킨다.
            
            자원의 총수와 현재 할단된 자원의 수를 기준으로 시스템을 안정상태와 불안정상태로 나누고 시스템이 안정 상태를 유지하도록 자원을 할당한다.

            - 은행원 알고리즘 (에츠허르 데이크스트라)
              : 각 프로세스는 자신이 사용할 자원의 최대 수를 운영체제에 알려준다.
                각 프로세스의 기대 자원과 비교하여 가용 자원이 크거나 같은 경우가 한번 이상인 경우 "안정 상태" 라고 한다.

            -> 프로세스가 자신이 사용할 모든 자원을 미리 선언해야 한다.
            -> 시스템의 전체 자우너 수가 고정적이어야 한다.
            -> 자원이 낭비된다.

        - 교착 상태 검출과 회복
          : 교착 상태 검출은 어떤 제약을 가하지 않고 자원 할당 그래프를 모니터링 하면서 교착 상태가 발생하는지 상표보는 방식이다.
            만약 교착 상태가 발생하면 교착 상태 회복 단계가 진행된다. -> 가장 현실적인 접근 방법이다.

            <교착 상태 검출>
            - 타임아웃 (가벼운 교착 상태 검출)
              : 일정 시간 동안 작업이 진행되지 않은 프로세스를 교착 상태가 발생한 것으로 간주하여 처리하는 방법이다.
                -> 엉뚱한 프로세스가 강제 종료될 수 있다.
                -> 모든 시스템에 적용할 수 있다.
            
            - 자원할당 그래프 (무거운 교착 상태 검출)
              : 자원할당 그래프르르 이용하여 교착 상태 검출
                단일 자원을 사용하는 경우 자원 할당 그래프에 사이클이 있으면 교착 상태다. 
                그러나 다중 자원을 사용하는 경우에는 자원 할당 그래프에 사이클이 있다고 해서 모두 교착 상태라고 판단할 수 없다.

                프로세스의 작업 방식을 제한하지 않으면서 교착 상태를 정확하게 파악할 수 있다는 장점이 있지만,
                자원 할당 그래프를 유지하고, 갱신하고, 사이클으르검사하는 추가 작업으로 인해 오버해드가 발생하는 단점이 있다.

            <교착 상태 회복>
            : 교착 상태를 유발한 프로세스를 강제로 종료한다.

            - 교착 상태를 일으킨 모든 프로세스를 동시에 종료한다.
            - 교착 상태를 일으킨 프로세스 중 하나를 골라 순서대로 종료한다. -> 기준이 필요한다.
                - 우선순위가 낮은 프로세스를 먼저 종료한다.
                - 우선순위가 같으면 작업 시간이 짧은 프로세스를 먼저 종료한다.
                - 위의 두 조건이 같으면 자원을 많이 사용하는 프로세스를 먼저 종료한다.

    

# Ch.05 프로세스 동기화

## 프로세스 간 통신
프로세스 혹은 스레드는 독립적으로 실행. 그러나 병렬적으로 처리하기 위해서는 데이터를 주고받아야 한다.
서로 다른 프로세스는 사용하는 메모리 영역이 다르기 때문에 데이터를 주고 받는 것이 쉽지 않음.
운영체제는 **프로세스와 프로세스끼리 쉽게 데이터를 주고 받을 수 있는 방법을 제공하는데 이를 프로세스 간 통신이라고 한다.**

## 프로세스 간 통신의 종류
1. 공유 메모리 또는 공유 파일을 이용한 통신
   1. 가장 원시적인 방법
   2. 데이터를 주고 받는 방법을 프로세스끼리 알아서 결정해야함
2. 파이프를 이용한 통신
   1. 하나의 컴퓨터 내에서 프로세스 간 통신에 많이 사용되는 수단
   2. `fork()` 로 만들어진 부모-자식 간 통신에 사용
3. 소켓을 이용한 통신
   1. 서로 다른 컴퓨터가 네트워크로 연결된 경우의 통신에 주로 사용되는 수단 (같은 컴퓨터 내에서도 가능)
   2. 같은 컴퓨터 내에서는 파이프가 더 효율적 why? 초기화할 내용도 많고 시스템 자원도 많이 사용됨

## 프로세스 간 통신의 분류
- 통신 방향에 따른 분류
  1. 양방향 통신
     1. 데이터를 양쪽 방향에서 동시에 전송할 수 있는 구조
     2. 일반적인 통신은 모두 양방향 통신. 소켓을 이용한 통신 = 양방향 통신
  2. 반양방향 통신
     1. 데이터를 양쪽 방향으로 전송할 수 있다.
     2. 동시 전송 불가능
     3. 특정 시점에 한쪽 방향으로만 전송할 수 있는 구조
  3. 단방향 통신
     1. 한쪽 방향으로만 데이터 전송할 수 있는 구조
     2. 공유 메모리나 공유 파일을 이용한 통신, 파이프를 이용한 통신이 해당

> 공유 메모리, 파일 통신 및 파이프도 양방향으로 구현 가능. 그러나 그에 따른 리소스가 추가적으로 필요.
> 공유 메모리, 파일 통신의 공유 메모리 2개 필요, 파이프 통신의 공유 2개의 파이프 필요

- 통신 구현 방식에 따른 분류
공유 메모리를 사용하는 통신 방식의 가장 큰 문제는 상대방이 데이터를 언제 보낼지 받는 쪽에서 모른다.
따라서 받는 쪽에서 수시로 데이터가 도착했는지 확인해야 하는데 이를 바쁜 대기(busy waiting)라고 한다.
시스템 차원에서는 바빤 대기는 자원 낭비가 크다.

바쁜 대기 문제를 해결하기 위해 데이터가 도착했음을 알려주는 동기화 사용. 동기화를 사용하면 바쁜 대기를 하지 않아도 운영체제가 알아서 알려준다

| 종류                  | 통신 기법               | 통신 기기 |
|---------------------|---------------------|-------|
| 대기가 있는 통신 (동기화 통신)  | 파이프 이용 통신, 소켓 이용 통신 | 전화    |
| 대기가 없는 통신 (비동기화 통신) | 공유 메모리나 공유 파일 이용 통신 | 전보    |

## 공유 자원
공유 자원은 여러 프로세스가 공동으로 이용하는 변수, 메모리, 파일 등을 말한다. 공유 자원은 공동으로 이용되기 때문에 누가 언제 데이터를 읽거나 쓰느냐에 따라 그 결과가 달라질 수 있다.
2개 이상의 프로세스가 공유 자원을 병행에서 읽거나 쓰는 상황을 경쟁 조건 (race condition)이 발생했다고 한다.

## 임계 구역 (Critical Section)
공유 자원 접근 순서에 따라 실행 결과가 달라지는 프로그램의 영역을 임계 구역이라고 한다.
임계구역에서는 프로세스들이 동시에 작업하면 안 된다. 한 프로세스가 임계구역에 들어가면 다른 프로세스는 임계구역 밖에서 기다려야 하며, 임계구역에 들어간 프로세스가 나와야 밖에 있던 프로세스가 들어갈 수 있다.


## 임계구역 문제 해결 조건
어떠한 방법이던 간에 아래의 3개의 문제를 해결해야 임계구역 문제가 해결 된다.

1. 상호배제 (Mutual Exclusion,  뮤텍스)
   1. 한 프로세스가 임계구역에 들어가면 다른 프로세스는 임계구역에 들어갈 수 없다.
   2. 임계구역 내에는 한 번에 하나의 프로세스만 있어야 한다.
2. 한정 대기 (bounded waiting)
   1. 어떠한 프로세스도 임계구역에 진입하지 못하여 무한 대기 하지 않아야 한다.
3. 진행의 융통성 (progress flexibility)
   1. 한 프로세스가 다른 프로세스의 진행을 방해해서는 안 된다.

## 임계구역 문제 해결 방법
1. 피터슨 알고리즘 (잘 사용되지 않는다)
   - 임계구역 문제를 해결 가능하지만 2개의 프로세스만 사용 가능하다는 한계
   - 여러 프로세스가 하나의 임계구엮을 사용하려면 공유 변수를 추가하고 코드를 변경해야한다.
2. 데커 알고리즘 (잘 사용되지 않는다)
   - 프로세스가 늘어나면 변수도 늘어나고 전체 알고리즘도 복잡해진다.
3. 세마포어
   1. 프로세스가 임계구역에 진입하기 전에 스위치를 사용 중으로 놓고 임계구역에 들어간다.
   2. 이후에 도착하는 프로세스는 앞의 프로세스가 작업을 마칠 때까지 기다린다.
   3. 작업을 하던 프로세스가 작업을 마치면 세마포어는 다음 프로세스에 임계구역을 사용하라는 동기화 신호를 보낸다
   - 다른 알고리즘과 달리 임계구역이 잠겼는지 직접 점검하거나, 바쁜 대기를 하거나, 다른 프로세스에 동기화 메세지를 보낼 필요가 없다.
   - 공유 자원이 여러 개일 때도 사용할 수 있다.
   - 잘못된 사용으로 임계 구역이 보호받지 못할 수도 있다.
4. 모니터
   - 세마포어 알고리즘의 문제를 해결하기 위해 등장
   - 공유 자원을 내부적으로 숨기고 공유 자원에 접근하기 위한 인터페이스만 제공함으로써 자원을 보호하고 프로세스 간에 동기화시킨다.
   - 시스템 호출과 같은 개념이다. 시스템 자원을 사용자로부터 숨기고 사용자 요구 사항을 처리할 수 있는 인터페이스만 제공한다.



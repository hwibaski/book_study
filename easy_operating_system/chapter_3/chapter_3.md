# Ch.03 프로세스와 스레드

## 1. 프로세스의 개요

: 운영체제에서의 프로세스는 하나의 작업 단위이다.

- 프로세스란?
  : 프로그램이 실행을 위해 메모리에 올라온 동적인 상태를 말한다. (모든 프로세스는 부모-자식 관계를 가진다.)

- 프로세스 제어블럭(PCB)
  : 프로세스를 실행하는 데 필요한 정보를 보관하는 자료구조 (커널 영역(운영체제 영역)에서 만들어짐)
  프로세스가 종료되면프로세스는 메모리에서 삭제되고 프로세스 제어블록도 폐기된다.

  - 프로세스 구분자
    : 각 프로세스를 구분하기 위한 구분자
  
  - 메모리 관련 정보
    : 프로세스 메모리 위치 정보, 메모리 보호를 위한 경계 레지스터와 한계레지스터
  
  - 각종 중간값
    : 프로세스가 사용헸던 중간값이 저장된다.

- 프로세스의 상태
  : 생성, 준비, "대기", 실행, 완료

  - 생성 상태(활성 상태)
    : 프로세스가 메모리에 올라와 실행 준비를 완료한 상태 (프로세스 제어블록 생성)
    
  - 준비 상태(활성 상태)
    : 생성된 프로세스가 CPU를 얻을때까지 기다리는 상태 (다음에 실행할 프로세스를 선정하는 일을 CPU 스케줄러가 담당한다. => CPU 스케줄러의 작업: 디스패치)
    
  - 대기 상태(활성 상태)
    : 실행 상태에 있는 프로세스가 입출력을 요청하면 입출력이 완료 될 떄까지 기다리는 상태 (작업의 효율을 높이기 위해 => 이 상태의 프로세스는 입출력 장치별 마련된 큐에서 기다린다. => 입출력이 완료되면 인터럽트가 발생하고 대기 상태에 있는 여러 프로세스 중 해당 입터럽트로 깨어날 프로세스를 찾아 PCB를 준비상태로 이동시킨다.)
    
  - 실행 상태(활성 상태)
    : 준비상태에 있는 프로세스 중 하나가 CPU를 얻어 실제 작업을 수행하는 상태
    
  - 완료 상태(활성 상태)
    : 실행 상태의 프로세스가 주어진 시간 동안 작업을 마친 상태 (프로세스 제어블록 삭제)

  * 휴식 상태
    : 프로세스가 작업을 일시적으로 쉬고 있는 상태 (프로세스가 메모리에 있으나 멈춘 상태)
  * 보류 상태
    : 프로세스가 메모리에서 잠시 쫓겨난 상태 (스왑 영역에 보관됨)

  => 프로세스에 배당된 작업 시간을 "타임 슬라이스" 또는 "타임 퀀텀" 이라고 하는데, 프로세스는 자신에게 주어진 하나의 타임 슬라이스 동안 작업을 끝내지 못하면 다시 준비 상태로 돌아간다. 이를 타임 아웃이라고 한다.

## 2. 프로세스 제어 블록

- PCB의 구성

  - 포인터
  - 프로세스 상태
  - 프로세스 구분자
  - 프로세스 카운터
  - 프로세스 우선순위
  - 각종 레지스터 정보
  - 메모리 관리 정보
  - 할당된 자원 정보
  - 계정 정보
  - 부모 프로세스 구분자와 자식 프로세스 구분자

- 문맥교환
  : 두 프로세스의 PCB를 교환하고 작업 환경을 바꾸는 작업

- 문맥교환의 절차
  : 한 프로세스가 자신에게 주어진 시간을 다 사용하면 발생하거나 인터럽트가 걸렸을때 발생한다.
  예를들어 p1이라는 프로세스가 자신에게 주어진 시단을 다 사용하여 타임아웃이 되면 p1의 PCB에 현재까지의 작업 결과가 저장되고 p1을 준비상태로 옮긴다. 준비상태에 있던 프로세스 p2가 실행 상태로 가면 CPU의 레지스터가 p2의 프로세스 제어블록 값으로 채워져 다음 작업을 하게 된다.

- 타임 슬라이스 크기
  : 되도록 작게 설정하되 문맥교환에 걸리는 시간을 고려하여 적당한 크기로 설정 (유닉스 운영체제에서의 타임 슬라이스는 대략 100ms)

## 3. 프로세스의 연산

- 프로세스의 구조

  - 코드 영역
    :프로그매의 본문이 기술된 곳으로 텍스트 영역이라고도 한다.
    
  - 데이터 영역
    : 코드가 실행되면서 사용하는 변수나 파일들이 각종 데이터를 모아놓은곳
    
  - 스택 영역
    : 운영체제가 프로세스를 실행하기 위해 부수적으로 필요한 데이터를 모아놓은 곳

- fork() 시스템 호출
  : 실행중인 프로세스로부터 새로운 프로세스를 복사하는 함수로 커널에서 저공한다. (두 프로세스는 부모-자식 관계로 연결된다.)

  - 장점
    - 프로세스 속도가 빠르다.
    - 추가 작업 없이 자원을 상속할 수 있다.
    - 시스템 관리를 효율적으로 할 수 있다.

- exec() 시스템 호출
  : 기존 프로세스를 새로운 프로세스로 전환하는 함수 (프로세스 구조를 재활용하기 위함)

  - 동작 과정
    - exec() 시스템 호출을 하면 코드 영역에 있는 기존 내용이 지워지고 새로운 코드로 바뀌고, 데이터 영역이 새로운 변수로 채워지며 스택 영역이 리셋된다.
    - 프로세스 제어 블록의 내용중에 프로세스 구분자, 부모 프로세스 구분자, 자식 프로세스 구분자, 메모리 관력 사항 등을 변하지 않는다.
    - 프로그램 카운터 레지스터 값을 비롯한 각종 레지스터와 사용한 파일 정보가 모두 리셋된다.

- 프로세스 계층 구조
  : fork(), exec() 시스템 호출을 사용하여 프로세스를 부모-자식으로 묶을 수 있다.

  - 장점

    - 여러 작업 동시 처리
    - 용이한 자원 회수

  - 고아 프로세스
    : 자식 프로세스가 종료되기 전에 부모 프로세스가 먼저 종료될때의 자식프로세스를 말함 (wait() 시스템 호출을 사용하여 방지할 수 있다.)
  - 좀비 프로세스
    : 자식 프로세스가 종료되었는데도 부모 프로세스가 뒤처리를 하지 않을때 발생한다. => 운영체제는 주기적으로 반환되지 못한 자원을 회수해야 한다.

## 4. 스레드

- 스레드란?
  : CPU가 처리하는 작업의 단위 (운영체제 입장의 작업 단위: 프로세스/ 처리(job) > 작업(job)> 스레드(operation))
  => 멀티 태스킹의 낭비 요소를 제거하기 위해 사용 (비슷한 일을 하는 2개의 프로세스를 만드는 대신 코드, 데이터등을 공유하면서 여러개의 일을 하나의 프로세스 내에서 하는것)

- 멀티스레드
  : 운영체제가 소프트웨어적으로 프로세스 내 작업을 여러개의 스레드로 분할함으로써 작업의 부담을 줄이는 프로세스 운영기법

  - 장점
    - 응답성 향상
    - 자원 공유
    - 효율성 향상
    - 다중 CPU 지원

  - 단점
    - 모든 스레드가 자원을 공유하기 대문에 한 스레드에 문제가 생기면 전체 프로세스에 영향을 미친다.

- 멀티태스크
  : 운영체제가 CPU에 작업을 줄 때 시간을 잘게 나누어 배분하는 기법

- 멀티 프로세싱
  : CPU를 여러개 사용하여 여러 개의 스레드를 동시에 처리하는 작업 환경

- CPU 멀티스레드

## 5. 동적 할당 영역과 시스템 호출

- 정적 할당 영역

  - 코드 영역
  - 데이터 영역

- 동적 할당 영역

  - 힙 영역
  - 스택 영역
    : 프로세스를 작동하기 위해 커널이 유지하는 자료구조

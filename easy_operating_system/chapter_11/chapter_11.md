# Ch.11 파일 시스템 

# 01. 파일과 파일 시스템

## 01-01. 파일 시스템의 개념
- 운영체제는 사용자에게 직접 파일을 보관하거나 접근하지 못하도록 한다. 운영체제는 파일을 보관하고 관리하는 파일 관리자를 두어 저장장치의 전체 관리를 맡기는데 이를 파일 
  시스템이라고 한다.
- 사용자가 특정 파일에 접근하려면 파일 관리자로부터 파일에 접근할 수 있는 권한(키)을 획득해야 하는데, 이를 파일 디스크립터라고 한다.

## 01-02. 파일 시스템의 기능
| 기능           | 설명                        |
|--------------|---------------------------|
| 파일 및 디렉토리 구성 | 사용자의 요구에 따라 파일과 디렉터리를 만든다.|
| 파일 및 디렉토리 관리 | 파일 및 디렉터리의 생성, 수정, 삭제 등을 관리하며, 사용자가 파일 및 디렉터리에 접근할 수 있도록 한다. |
| 접근 방법 제공     | 파일과 디렉터리에서 읽고 쓰고 실행할 수 있도록 사용자에게 접근 방법을 제공한다. |
| 접근 권한 관리     | 다른 사용자에게서 파일 및 디렉터리를 보호하기 위해 접근 권한을 관리한다. |
| 무결서 보장       | 파일 내용이 손상되지 않도록 무결성을 보장한다. |
| 백업과 복구       | 파일을 보호하기 위해 백업과 복구 작업을 한다. |
| 암호화          | 파일을 암호화하여 악의적인 접근으로부터 파일을 보호한다. |

## 01-03. 블록과 파일 테이블
- 저장장치에서는 파일을 일정 크기로 묶어서 관리하는데 이를 블록이라고 한다.
- 블록은 저장장치에서 사용하는 가장 작은 단위로, 한 블록에 주소 하나가 할당되며 운영체제와 저장장치 사이에서는 파일을 블록 단위로 전송한다.

## 01-04. 파일 종류와 확장자
- 파일 종류
  - 실행 파일 : 운영체제가 메모리로 가져와 CPU를 이용하여 작업하는 파일이다. 즉 사용자의 요청으로 프로세스가 된 파일이다.
  - 데이터 파일 : 실행 파일이 작업하는 데 필요한 데이터를 모아놓은 파일. 데이터 파일은 스스로 프로세스가 될 수 없고, 운영체제가 전송하거나 보관만 할 뿐 특별하게 
    다루지 않는다. 운영체제가 바라보는 모든 데이터 파일은 0과 1로 이루어진 데이터 덩어리일 뿐이다.

| 파일       | 확장자                      | 설명                  |
|----------|--------------------------|---------------------|
| 실행 파일    | exe, com                 | 유닉스에는 실행 파일 확장자가 없음 |
| 소스코드 파일  | c, cpp, pas, a, java     | 다양한 소스코드의 확장자       |
| 라이브러리 파일 | lib, a, dll              | 소스코드를 위한 라이브러리의 확장자 |
| 배치 파일    | bat, sh, csh             | 초기 배치 파일의 확장자       |
| 문서 파일    | txt, doc, hwp, pdf, ps 등 | 문서 데이터 파일의 확장자      |
| 동영상 파일   | avi, asf, mkv, mov, rmv  | 동영상 데이터 파일의 확장자     |
| 음악 파일    | wav, mp3, ogg, flc, aac  | 음악 데이터 파일의 확장자      |
| 이미지 파일   | bmp, gif, jpg, png, webp | 이미지 데이터 파일의 확장자     |
| 압축 파일    | rar, zip, arc, al        | 압축 파일의 확장자          |

## 01-05. 파일 속성
| 속성            | 특징           | 설명                                                     |
|---------------|--------------|--------------------------------------------------------|
| name          | 파일 이름        | 확장자를 포함한 전체 이름                                         |
| type          | 파일 종류        | 실행 파일, 동영상 파일과 같이 확장자로 구분                              |
| size          | 파일 크기        | 파일의 용량                                                 |
| time          | 파일에 대한 접근 시간 | 생성 시간, 변경 시간, 최근 파일을 열어본 시간 등으로 세분                     |
| location      | 파일 위치        | 이름과 확장자가 같은 두 파일은 한 디렉터리에 존재할 수 없으며, 서로 다른 디렉터리에 각각 존재 |
| accessibility | 파일에 대한 접근 권한 | 윈도우에서는 파일에 대한 접근 권한이 읽기, 쓰기, 숨김 파일 정도록 구분              |
| owner         | 파일 소유자       | 유닉스에서는 소유자, 그룹, 제삼자에 따라 다르게 설정 가능                      |

## 01-06. 파일 작업
| 작업     | 설명           |
|--------|--------------|
| open   | 파일을 연다       |
| close  | 파일을 닫는다      |
| create | 새로운 파일을 생성한다 |
| remove | 파일을 이동한다     |
| copy   | 파일을 복사한다     |
| rename | 파일을 이름을 변경한다 |
| list   | 파일을 나열한다     |
| search | 파일을 찾는다.     |

## 01-07. 파일 헤더
- 파일 속성과 달리 파일마다 자신에게 필요한 정보를 따로 정의하여 사용할 수 있는데, 이는 파일 헤더에 기록된다.

## 01-08. 저장장치 관리 기법
- 파티션
  - 저장장치를 2개 이상의 묶음으로 나누는 것
  - 디스크를 논리적으로 분할하는 작업
  - 분리된 파티션마다 파일 시스템이 탑재된다
  - 유닉스는 여러 개의 파티션을 통합하는 기능을 가지고 있다. -> 저장장치나 파티션의 개수에 상관없이 하나의 파일 시스템만 가진다
  - 유닉스에서 여러 개의 파티션을 하나로 통합하는 기능을 마운트라고 한다.

- 조각 모음
  - 하드디스크에 조각이 많이 생기면 큰 파일이 여러 조각으로 나뉘어 저장된다. 이를 읽으려면 하드디스크의 여러 곳을 돌아다녀야 하므로 성능 저하로 이어진다.
  - 이러한 문제를 방지하려면 주기적으로 조각 모음을 해주어야 한다.

## 01-09. 파일 구조
- 순차 파일 구조
  - 파일 내용이 하나의 긴 줄로 늘어선 형태 (e.g. 카세트 테이프)
  - 장점
    - 모든 데이터가 순서대로 기록되기 때문에 저장 공간에 낭비되는 부분이 없다
    - 구조가 단순하여 테이프는 물론 플로피디스크나 메모리를 이용한 저장장치에도 적용할 수 있따.
    - 순서대로 데이터를 읽거나 저장할 때 매우 빠르게 처리된다.
  - 단점
    - 파일에 새로운 데이터를 삽입하거나 삭제할 때 시간이 많이 걸린다.
    - 중간에 데이터를 삽입하려면 데이터를 뒤로 밀어 빈 공간을 만들어야 하고, 중간에 데이터를 삭제하려면 남은 빈 공간을 메우기 위해 데이터를 앞으로 당겨야 한다.
    - 특정 데이터로 이동할 때 직접 접근이 어렵기 때문에 앞에서부터 순차적으로 움직여야 한다.

- 인덱스 파일 구조
  - 순차 파일 구조의 단점을 해결한 것으로 인덱스 테이블을 추가하여 순차 접근과 직접 접근이 가능하다.
  - 현대의 파일 시스템은 인덱스 파일 구조다. 순차 파일 구조로 파일을 저장하고, 인덱스 테이블을 보고 원하는 파일에 직접 접근한다.

- 직접 파일 구조
  - 해시 함수 이용

# 02. 디렉터리의 구조

## 02-01. 디렉터리의 개념
- 디렉터리는 관련 있는 파일을 하나로 모아놓은 곳으로 1개 이상의 자식 디렉터리와 1개 이상의 파일을 가질 수 있다. 즉, 하나의 디렉터리에는 여러 개의 파일과 자식 
  디렉터리가 존재한다.
- 디렉터리도 파일이다. 디렉터리에도 일반 파일과 마찬가지로 헤더가 있다. 디렉토리 헤더에는 디렉터리 이름, 만든 시간, 접근 권한 등의 정보가 기록되어 있다.

# 03. 디스크 파일 할당

## 03-01. 할당 방식
- 연속 할당
  - 파일을 구성하는 데이터를 디스크상에 연속적으로 배열하는 간단한 방식
  - 시작 블록만 알면 전체 파일을 찾을 수 있으나 실제로는 사용되지 않는다.
  - 파일을 저장하거나 삭제해다 보면 빈 공간이 생기는데, 디스크에 남은 공간 중 파일의 크기와 맞는 연속된 공간이 없을 때는 연속 할당이 불가능하기 때문이다.
- 불연속 할당
  - 비어 있는 블록에 데이터를 분산하여 저장하고 이에 관한 정보를 파일 시스템이 관리하는 방식이다.
    - 연결 할당
      - 파일에 속한 데이터를 연결 리스트로 관리하는 방식이다.
      - 테이블에는 시작 블록에 대한 정보만 저장하고, 나머지 데이터는 시작 블록부터 연결하여 저장
      - 연결 할당 방식은 테이블 형태로 관리된다. (윈도우의 FAT)
      - 테이블을 이용한 방식의 단점은 하나의 파티션이 사용할 수 있는 디스크 용량이 테이블의 주소 크기로 제한된다는 점이다.
        - FAT16 (16bit) -> 32GB
        - FAT32 (32bit) -> 8TB, 파일 하나의 크기가 4GB로 한정
        - 이러한 이유 때문에 윈도우 운영체제는 NTFS 파일 시스템 사용
    - 인덱스 할당
      - 데이터의 인덱스를 담고 있는 인덱스 블록을 연결한다. 인덱스 블록은 실제 데이터의 위치에 관한 정보를 순서대로 보관하고 있다.
      - 파일의 끝을 알리는 -1은 널을 의미한다.
      - 아이노드(i-node) 방식을 이용하는 유닉스 운영체제는 간접인덱스 블록을 만들면서 테이블을 무한히 확장할 수 있다.

## 03-02. 빈 공간 관리
- 디스크에 파일을 저장할 때마다 모든 테이블을 뒤져서 빈 공간을 찾는 것은 비효율적이다. 디스크의 내부 단편화를 줄이고 빈 공간을 효율적으로 관리하기 위해 파일 시스템은 
  빈 블록의 정보만 모아놓은 빈 공간 리스트를 유지한다.
- 파일이 삭제되어도 해당 파일이 사용하던 블록의 내용은 지워지지 않고 빈 공간 리스트에 삽인이 된다. (논리적 삭제)
- 파일이 사용했던 공간을 일일이 지우려면 시간이 많이 걸린다. 파일 시스템에서는 파일 테이블의 헤더를 삭제하고, 사용했던 블록을 빈 공간 리스트에 등록하는 것을 파일 
  삭제로 간주한다.
- 블록의 내용을 지우지 않고 빈 공간 리스트에 삽입하는 것은 해당 블록에 새로운 데이터를 덮어쓰지 않는 한 원래 데이터를 복구할 수 있는 여지를 남긴다.

## 04. 유닉스 파일의 특징
![image](https://github.com/hwibaski/book_study/assets/85930725/af4c5dde-c6d6-4a82-83ca-7c01d03696d9)

- 출처(https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=robotluv1226&logNo=220618363082)
- read는 4, write 는 2, execute는 1이며 chmod 명령을 이용하여 살리고 싶은 숫자를 모두 더하면 된다.
